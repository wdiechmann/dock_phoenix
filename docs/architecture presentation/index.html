<!doctype html>
<html lang="en" prefix="og: http://ogp.me/ns#">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- SEO -->
    <title>EPDAP</title>
    <meta name="description" content="Elixir/Elm Meetup Presentation titled: Elixir/Phoenix with Docker App Provisioning">

    <!-- URL CANONICAL -->
    <!-- <link rel="canonical" href="http://your-url.com/"> -->

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Cedarville+Cursive|Roboto:100,100i,300,300i,400,400i,700,700i%7CMaitree:200,300,400,600,700&amp;subset=latin-ext" rel="stylesheet">

    <!-- CSS Base -->
    <link rel="stylesheet" type='text/css' media='all' href="static/css/base.css">

    <!-- CSS Colors -->
    <link rel="stylesheet" type='text/css' media='all' href="static/css/colors.css">

    <!-- Optional - CSS SVG Icons (Font Awesome) -->
    <link rel="stylesheet" type='text/css' media='all' href="static/css/svg-icons.css">

    <!-- SOCIAL CARDS (ADD YOUR INFO) -->

    <!-- FACEBOOK -->
    <meta property="og:url" content="http://your-url.com/"> <!-- YOUR URL -->
    <meta property="og:type" content="article">
    <meta property="og:title" content="WebSlides — Making HTML Presentations Easy"> <!-- EDIT -->
    <meta property="og:description" content="WebSlides is about telling stories beautifully. Just the essential features. Good karma."> <!-- EDIT -->
    <meta property="og:updated_time" content="2017-01-04T17:20:50"> <!-- EDIT -->
    <meta property="og:image" content="static/images/share-webslides.jpg"> <!-- EDIT -->

    <!-- TWITTER -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:site" content="@wdiechmann"> <!-- EDIT -->
    <meta name="twitter:creator" content="@wdiechmann"> <!-- EDIT -->
    <meta name="twitter:title" content="Walther Diechmann - made the Kessel run from CP/M on Casio FP1100 to OSX on MBP in just shy of 11 parsecs "> <!-- EDIT -->
    <meta name="twitter:description" content="son, farther, brother, grandfarther, brother-in-law, love, developer, tinker"> <!-- EDIT -->
    <meta name="twitter:image" content="static/images/twitter_avatar_400x400.png"> <!-- EDIT -->

    <!-- FAVICONS -->
    <link rel="shortcut icon" sizes="16x16" href="static/images/favicons/favicon.png">
    <link rel="shortcut icon" sizes="32x32" href="static/images/favicons/favicon-32.png">
    <link rel="apple-touch-icon icon" sizes="76x76" href="static/images/favicons/favicon-76.png">
    <link rel="apple-touch-icon icon" sizes="120x120" href="static/images/favicons/favicon-120.png">
    <link rel="apple-touch-icon icon" sizes="152x152" href="static/images/favicons/favicon-152.png">
    <link rel="apple-touch-icon icon" sizes="180x180" href="static/images/favicons/favicon-180.png">
    <link rel="apple-touch-icon icon" sizes="192x192" href="static/images/favicons/favicon-192.png">

    <!-- Android -->
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#333333">

    <style>
      @media (min-width: 1024px) {
        .text-interview dt { margin-left: -36%; }
      }      
      dt { color: grey }
      pre.steps { line-height: 1.0rem; }
      pre dl dt, pre dl dd { line-height: 1.5rem; margin-bottom: 0.5rem;  }
      .draw-steps { font-size: 5rem; color: #300000; font-weight: 700;  }
      .draw-steps p { line-height: 6rem }

      .brown-text { color: #fff }
      .red-text { color: #ff0000 }
      .yellow-text { color: #00ff00 }
      .semi-transparent { background-color: rgba(114, 58, 39, 0.3) } 
      .semi-white { background-color: rgba(211, 211, 211, 0.53) } 
      p.tiny { font-size: 14px; line-height: 1.75rem; }
      
      .animate-show {
        display: none !important;
      }
      .animate-show.animated {
        display: inherit !important;
      }

      .example-block {
        width: 100px;
        height: 100px;
        position: relative;
        left: 0;
        transition: all 500ms ease;
      }
      .example-block.animate {
        left: calc(100% - 100px);
      }      
      
      .napkin {
        transform: rotate(-13deg);
        font-family: 'Cedarville Cursive', cursive;
        margin-top: -300px;
      }
    </style>

  </head>
  <body>
    <header role="banner">
      <nav role="navigation">
        <p class="logo"><a href="index.html" title="WebSlides">DPEPA</a></p>
        <ul>
          <li class="github">
            <a rel="external" href="https://github.com/webslides/webslides" title="Github">
              <svg class="fa-github">
                <use xlink:href="#fa-github"></use>
              </svg>
              <em>WebSlides</em>
            </a>
          </li>
          <li class="twitter">
            <a rel="external" href="https://twitter.com/webslides" title="Twitter">
              <svg class="fa-twitter">
                <use xlink:href="#fa-twitter"></use>
              </svg>
              <em>@WebSlides</em>
            </a>
          </li>
          <!--  <li class="dribbble"><a rel="external" href="http://dribbble.com/webslides" title="Dribbble"><svg class="fa-dribbble"><use xlink:href="#fa-dribbble"></use></svg> <em>webslides</em></a></li> -->
        </ul>
      </nav>
    </header>

    <main role="main">
      <article id="webslides" class="vertical">
        <!-- Quick Guide
          - Each parent <section> in the <article id="webslides"> element is an individual slide.
          - Vertical sliding = <article id="webslides" class="vertical">
          - <div class="wrap"> = container 90% / <div class="wrap size-50"> = 45%;
        -->

        <!-- slide 1 -->
        <section class="bg-black">
         <span class="background dark" style="background-image:url('/static/images/maersk.jpg')"></span>
         
          <!--.wrap = container (width: 90%) -->
          <div class="wrap aligncenter">
            <h1><strong style="font-size: 72px;color: white">Docker Provisioning <BR />of Elixir/Phoenix App</strong></h1>
            <p class="text-intro"><br>
              A quick presentation of<br/>
              how-to Develop, Test, and Deploy Elixir/Phoenix apps with Docker technology!
            </p>
          </div>
          <!-- .end .wrap -->
        </section>
        
        <!-- slide 2 -->
        <section class="bg-black slide-bottom ">
          <span class="background dark" style="background-image:url('https://source.unsplash.com/9o8YdYGTT64/')"></span>
         
          <!--.wrap = container (width: 90%) -->
          <div class="wrap content-center">
            <h1><strong style="font-size: 72px;color: white">Disclaimers!</strong></h1>
            <p class="text-intro">It's not rocket-science - and I found all of it on the Internet</p>
            <div class="">
              I will not present, <br>
              using <a href="https://github.com/hashrocket/gatling">Gatling</a>, <a href="http://nsomar.com/how-to-use-flynn-to-deploy-a-phenix-app/">Flynn</a><br>
              or <a href="http://box.cloudless.studio/"> Cloudless</a> for that matter!!<br>
              Docker Enterprise stuff <br>
              running your own <strong style="color: red">GitLab</strong>, running your own <strong style="color: red">Docker Registry</strong>,<br>
              how-to configure <strong style="color: red">Nginx with SSL</strong>, <strong style="color: red">'hot reload'</strong> migrations, <br>
              <strong style="color: red">Docker Swarm</strong> setup, and I will not talk about DevOps <strong style="color: red">instrumentation</strong> (Chef/Puppet/Salt,etc)<br>
              even though I was tempted to copy/paste this <a href="http://blog.lunarlogic.io/phoenix-app-deployment-with-ansible-playbooks-for-elixir">Ansible Playbook</a>
                
            </div>
          </div>
          <!-- .end .wrap -->
        </section>
        
        <!-- slide 3 -->
        <section>
          <!--.wrap = container (width: 90%) -->
          <div class="wrap  aligncenter">
            <h2><strong>Why Docker?</strong></h2>
            <p class="text-intro">Its <a href="http://www.techrepublic.com/article/why-docker-and-why-now/" >timing</a> is perfect, developers <a href="https://blog.docker.com/2015/03/why-i-love-docker-and-why-youll-love-it-too/" >love</a> it, and the <a href="https://www.ctl.io/developers/blog/post/what-is-docker-and-when-to-use-it/" >technology</a> is like Git!</p>
            <div class="bg-white shadow">
              <ul class="flexblock reasons">
                <li>
                  <h2>Write Once, Run Anywhere.</h2>
                  <p>Not entirely true, however, Docker is the best image sharing technology presently!</p>
                </li>
                <li>
                  <h2>Work better, faster.</h2>
                  <p>100,000+ images available on <a href="https://hub.docker.com/" >Docker Hub</a> allows developers to utilise just about any combination of technologies in a matter of minutes - not weeks or days!</p>
                </li>
                <li>
                  <h2>Use it for development, testing, and deployment</h2>
                  <p>No local install! Easily select amongst any number of versions of Elixir/Phoenix/etc</p>
                  <p>What Nirvana when your development environment is the exact same environment that you will test and deploy to!</p>
                </li>
              </ul>
            </div>
            <!-- .end .bg-white shadow -->
          </div>
          <!-- .end .wrap -->
        </section>
        
        <!-- slide 4 -->
        <section>
          <!--.wrap = container (width: 90%) -->
          <div class="wrap">
            <div class="grid vertical-align">
              <div class="column">
                <h3><strong>Docker is really easy</strong></h3>
                <p class="text-intro">Add a <code>Dockerfile</code> to your project and in 1 sweat step you've created a packaged deliverable ready to deploy most anywhere! </p>
                <p>The Dockerfile is a <strong>spec</strong> of how to run your <i>service</i> on hosts equipped to understand.</p>
                <p style="color: red">But deploying Elixir/Phoenix projects <a href="https://github.com/ibgib/ibgib/issues/74">apparently</a> is quite another story all together!</p>
              </div>
              <!-- .end .column -->
              <div class="column">
                <pre>

<span class="code-comment"># ./Dockerfile</span>
<span class="code-comment"># 20170314, ALCO Company - @wdiechmann</span>
<b style="color: teal">FROM</b> nginx:1.9
  <span class="code-comment">#  default conf for proxy service </span>
<b style="color: teal">COPY</b> ./services.conf /etc/nginx/conf.d/default.conf  

<span class="code-comment"># 404’s,500’s etc responses</span>
<b style="color: teal"> COPY</b> ./html/ /var/www/html/  

<span class="code-comment">#  Proxy and SSL configurations </span>
<b style="color: teal">COPY</b> ./includes/ /etc/nginx/includes/  

<span class="code-comment"># Proxy SSL certificates </span>
<b style="color: teal">COPY</b> ./ssl/ /etc/ssl/certs/nginx/

<span class="code-comment">  # make sure time is set correctly </span>
<span style="background-color: yellow"><b style="color: teal">RUN</b> echo Europe/Copenhagen \
    > /etc/timezone && \
    dpkg-reconfigure -f \
    noninteractive tzdata</span>
                </pre>
              </div>
              <!-- .end .column -->
            </div>
            <!-- .end .grid -->
          </div>
          <!-- .end .wrap -->
        </section>

        
        <!-- slide 5 -->
        <section>
          <!--.wrap = container (width: 90%) -->
          <div class="wrap">
            <div class="grid vertical-align">
              <div class="column">
                <h3><strong>Timezone/Locale is easy too - kind'a!</strong></h3>
                <p class="text-intro">The <code>/etc/locale.conf</code> sets the default locale and the timezone is by default controlled by the host</p>
                <p>The occasional offset with containers required to run non-host timezone may be solved using <strong>dpkg-reconfigure</strong> and <code>/etc/timezone</code> (which is a soft symlink to eg. /usr/share/zoneinfo/Europe/Copenhagen or <code> echo Europe/Copenhagen > /etc/timezone</code>)</p>
                <p>Using <strong>ntpd</strong> is not necessary as the clock will be sync'ed with the host - if the host is sync'ed; but YMMV! :)</p>
              </div>
              <!-- .end .column -->
              <div class="column">
                <pre>

<span class="code-comment"># ./Dockerfile</span>
...
<b style="color: teal">RUN</b> apt-get install \
    --no-install-recommends \
    -y tzdata locales debconf 
<b style="color: teal">RUN</b><span style="background-color: yellow"> echo 'da_DK.UTF-8 UTF-8' >> \
    /etc/locale.gen && locale-gen</span>
<b style="color: teal">ENV</b> LANG da_DK.UTF-8 
...
<b style="color: teal">RUN</b> ln -s \
    /usr/share/zoneinfo/Europe/Copenhagen \
    /etc/timezone
<b style="color: teal">RUN</b> dpkg-reconfigure -f noninteractive \
    tzdata
...

<span class="code-comment"># /etc/locale.conf</span>
LANG=da_DK.utf-8 
                </pre>
              </div>
              <!-- .end .column -->
            </div>
            <!-- .end .grid -->
          </div>
          <!-- .end .wrap -->
        </section>

        <!-- slide 6 -->
        <section class="">
          <span data-step-count=3></span>
          <span class="background dark" style="background-image:url('/static/images/coffee_stains.jpg')"></span>
          <!--.wrap = container (width: 90%) -->
          <div class="content brown-text">
            <div class="wrap"  style="margin-top: 7cm; margin-left: 0.5cm">
              <div class="grid ms brown-text">
                <div class="column">
                  <h3 ><strong>Draw!</strong></h3>
                  <p class="text-intro " >The prerequisitative napkin <br> - with coffee stains and lipstick!</p>
                  <p >What services?</p>
                  <p >Any dependencies?</p>
                  <p >How does 'the world' access  <br>all this - if at all?</p>
                </div>
                <!-- .end .column -->
                <div class="column draw-steps napkin">
                  <ul >
                    <!-- animate first step -->
                    <li class="animate-show " data-step=2>
                      <p class="alignleft">postgreSQL</p>
                    </li>
                    <!-- animate second step -->
                    <li class="animate-show " data-step=1>
                      <p class="alignleft">Elixir App</p>
                    </li>
                    <!-- animate third step -->
                    <li class="animate-show " data-step=3>
                      <p class="alignleft">nginx</p>
                    </li>
                  </ul>
                </div>
                <!-- .end .column -->
              </div>
              <!-- .end .grid -->
            </div>
            <!-- .end .wrap -->            
          </div>
          <!-- .end .content-left -->
        </section>

        <!-- slide 7 -->
        <section>
          <!--.wrap = container (width: 90%) -->
          <div class="wrap">
            <div class="grid vertical-align">
              <div class="column">
                <h3><strong>One container - one proces</strong></h3>
                <p class="text-intro">Nothing guards you from adding multiple processes to a container - except best practise!</p>
                <p>Keeping your processes <strong>compartmentalized</strong> maximizes your choices when challenged with scaling</p>
                <p>Cue <code>docker-compose</code>. Compose is a tool for defining and running multi-container Docker applications. With Compose, you use a Compose file to configure your application’s services. Then, using a single command, you create and start all the services from your configuration. </p>
                <p>Compose is great for development, testing, and staging environments, as well as CI workflows. </p>
              </div>
              <!-- .end .column -->
              <div class="column">
                <pre>
<b style="color: maroon">version:</b> "2.0"
<b style="color: maroon">services:</b>
  <b style="color: maroon">proxy:</b>
    <b style="color: maroon">build:</b> ./nginx
    <b style="color: maroon">networks:</b>
    - web
    <b style="color: maroon">links:</b>
    - appserver:appserver
    <b style="color: maroon">ports:</b>
    - "80:80"
    - "443:443"
  <b style="color: maroon">appserver:</b>
    <b style="color: maroon">container_name:</b> mandarin_app
    <b style="color: maroon">build:</b> ./pigeon-server
    <b style="color: maroon">environment:</b>
      <b style="color: maroon">PORT:</b> "4000"
      <b style="color: maroon">MIX_ENV:</b> "prod"

                </pre>
              </div>
              <!-- .end .column -->
            </div>
            <!-- .end .grid -->
          </div>
          <!-- .end .wrap -->
        </section>
        
        <!-- slide 8 -->
        <section>
          <div class="wrap">
            <h2><strong> Steps in the Develop, Test, Deploy Process</strong></h2>
            <p class="text-intro">The local/on-premises/controlled-by-yourself hosting develop/test/deploy process has 6 steps:</p>
            <div class="grid">
              <div class="column">
                  <p><strong>1: Develop:</strong> 2 strategies (semi-local or full-container) - either way; you may run development cycles at will,</p>
                  <p><strong>2: Build:</strong> and once you're ready to build: do so! Each application has its own container with specific build steps that can be changed anytime,</p>
                  <p><strong>3: Upload:</strong> After building our application container, we need to send it to the Docker Registry. The first time we do this it's going to take some time, because we'll need to upload the whole container, but the next time will be faster, due to the Docker layer system, which helps us save space and bandwidth.</p>

              </div>
              <div class="column">
                  <p><strong>4: Connect:</strong> After sending our container to the Docker Registry, we need to connect to the host to run the next steps,</p>
                  <p><strong>5: Download:</strong> After connecting to the host, it’s time to download our container, and</p>
                  <p><strong>6: Restart:</strong> The last step consists of stopping the running application and starting the new container with the same configuration as the stopped one (ports, logs, environment variables, etc).</p>
              </div>
            </div>
            <p>Focus in this presentation will be on steps 1, 2, and 3</p>
          </div>
        </section>




        <!-- slide 9 -->
        <section>
          <!--.wrap = container (width: 90%) -->
          <div class="wrap">
            <div class="grid vertical-align">
              <div class="column">
                <h3><strong>1: Develop</strong> - <small>first steps</small></h3>
                <p class="text-intro">A fresh Phoenix app <br>- and a Dockerfile to run the (My)SQL server</p>
                <pre class="steps">
                  <dl class="text-interview">
                      <dt>1</dt><dd>mkdir ~/projects/meetup \ <br>&& cd ~/projects/meetup</dd>
                      <dt>2</dt><dd>mkdir mysql mysql/data \ <br>&& vi mysql/Dockerfile mysql/setup.sql</dd>
                      <dt>3</dt><dd>mix phx.new meetup --database=mysql </dd>
                      <dt>4</dt><dd>vi meetup/config/dev.exs (add mysql creds)</dd>
                  </dl>
                </pre>
              </div>
              <!-- .end .column -->
              <div class="column">
                <pre>
<span class="code-comment"> # ./mysql/Dockerfile</span>                  
<b style="color: teal">FROM</b> mysql:latest

<b style="color: teal">RUN</b> apt-get update && \
    apt-get install -y git apt-utils && \
    apt-get install \
    --no-install-recommends -y tzdata \
    locales debconf && \
    apt-get clean && \
    rm -r /var/lib/apt/lists/*
<span class="code-comment"># timezone/locale hidden</span>
<b style="color: teal">ADD</b> setup.sql /docker-entrypoint-initdb.d/
<b style="color: teal">EXPOSE</b> 3306
                </pre>
                <p></p>
                <pre>
<span class="code-comment"> # ./mysql/setup.sql</span>
<b style="color: teal">DROP USER</b> 'meetup';
<b style="color: teal">CREATE USER</b> 'meetup'@'%' <b style="color: teal">IDENTIFIED BY</b> 'pASSword';
<b style="color: teal">GRANT ALL PRIVILEGES ON</b> *.* <b style="color: teal">TO</b> 'meetup'@'%';
<b style="color: teal">FLUSH PRIVILEGES</b>;
                </pre>
              </div>
              <!-- .end .column -->
            </div>
            <!-- .end .grid -->
          </div>
          <!-- .end .wrap -->
        </section>

        <!-- slide 10 -->
        <section>
          <!--.wrap = container (width: 90%) -->
          <div class="wrap">
            <div class="grid vertical-align">
              <div class="column">
                <h3><strong>1: Develop</strong> - <small>firm footing</small></h3>
                <p class="text-intro">Docker Compose - making it a concerted effort (semi-local)!</p>
                <pre class="steps">
                  <dl class="text-interview">
                      <dt>5</dt><dd>vi ~/projects/meetup/docker-compose.yml</dd>
                      <dt>6</dt><dd>docker-compose up -d db</dd>
                      <dt>7</dt><dd>cd ~/projects/meetup/meetup</dd>
                      <dt>8</dt><dd>MIX_ENV=dev mix ecto.create</dd>
                      <dt>9</dt><dd>MIX_ENV=dev mix phx.server</dd>
                  </dl>
                </pre>
              </div>
              <!-- .end .column -->
              <div class="column">
                <pre>
<span class="code-comment"> # ./docker-compose.yml</span>
<b style="color: maroon">version:</b> "2.0"
<b style="color: maroon">services:</b>
  <b style="color: maroon">db:</b>
    <b style="color: maroon">container_name:</b> meetup_db
    <b style="color: maroon">build:</b> ./mysql
    <b style="color: maroon">environment:</b>
      <b style="color: maroon">MYSQL_DATABASE:</b> meetup_dev
      <b style="color: maroon">MYSQL_ROOT_PASSWORD:</b> meetup
      <b style="color: maroon">MYSQL_USER:</b> meetup
      <b style="color: maroon">MYSQL_PASSWORD:</b> meetup
    <b style="color: maroon">ports:</b>
    - "3306:3306"
    <b style="color: maroon">volumes:</b>
    - ./mysql/data:/var/lib/mysql
                </pre>
              </div>
              <!-- .end .column -->
            </div>
            <!-- .end .grid -->
          </div>
          <!-- .end .wrap -->
        </section>

        <!-- slide 11 -->
        <section>
          <!--.wrap = container (width: 90%) -->
          <div class="wrap">
            <div class="grid vertical-align">
              <div class="column">
                <pre class="steps">
                  <dl class="text-interview">
                    <dt>1</dt><dd>mkdir ~/projects/dock_phoenix && \<br>cd ~/projects/dock_phoenix</dd>
                    <dt>2</dt><dd>vi docker-compose.yml</dd>
                    <dt>3</dt><dd>docker-compose up -d postgres</dd>
                  </dl>
                </pre>
                <p>Creating a PostgreSQL Container w/default user & password: https://medium.com/@beld_pro/quick-tip-creating-a-postgresql-container-with-default-user-and-password-8bb2adb82342 </p>
                <pre>
<span class="code-comment"># ./docker-compose.yml (postgres db)</span>
  <b style="color: maroon">postgres:</b>
    <b style="color: maroon">image:</b> postgres:9.3.17-alpine
    <b style="color: maroon">volumes:</b>
       - db_data:/var/lib/postgresql/data
    <b style="color: maroon">environment:</b>
      - POSTGRES_PASSWORD=secret
      - POSTGRES_USER=phoenix
      - POSTGRES_DB_NAME=dock_phoenix_dev
<span class="code-comment"># create a named datavolume</span>
<b style="color: maroon">volumes: </b>
    <b style="color: maroon">db_data:</b>
                </pre>
              </div>
              <!-- .end .column -->
              <div class="column">
                <h3><strong>1: Develop</strong> - <small>dipping toes</small></h3>
                <p class="text-intro">Keeping it all in containers</p>
                <pre>
<span class="code-comment"># ./docker-compose.yml</span>
<b style="color: maroon">version: '2'</b>
<b style="color: maroon">services:</b>  
  <b style="color: maroon">dock_phoenix:</b>
    <b style="color: maroon">image:</b> dock_phoenix/web
    <b style="color: maroon">build:</b>
      <b style="color: maroon">context:</b> .
      <b style="color: maroon">dockerfile:</b> Dockerfile.development
    <b style="color: maroon">ports:</b>
      - "4000:4000"
    <b style="color: maroon">volumes:</b>
      - .:/app
    <b style="color: maroon">depends_on:</b>
      - postgres
    <b style="color: maroon">environment:</b>
      - POSTGRES_PASSWORD=secret
      - POSTGRES_USER=phoenix
      - POSTGRES_DB_NAME=dock_phoenix_dev
                </pre>
              </div>
              <!-- .end .column -->
            </div>
            <!-- .end .grid -->
          </div>
          <!-- .end .wrap -->
        </section>

        
        <!-- slide 12 -->
        <section>
          <!--.wrap = container (width: 90%) -->
          <div class="wrap">
            <div class="grid vertical-align">
              <div class="column">
                <h3><strong>1: Develop</strong> - <small>knee-high</small></h3>
                <p class="text-intro">Batteries included!</p>
                <pre class="steps">
                  <dl class="text-interview">
                    <dt>4</dt><dd>vi Dockerfile.development</dd>
                    <dt>5</dt><dd>docker-compose run --rm dock_phoenix \<br>mix phoenix.new . --app dock_phoenix</dd>
                    <dt>6</dt><dd>docker-compose run --rm dock_phoenix \<br>mix ecto.create</dd>
                    <dt>7</dt><dd>docker-compose run --rm --service-ports\<br> dock_phoenix mix phoenix.server</dd>
                  </dl>
                </pre>
              </div>
              <!-- .end .column -->
              <div class="column">
                <pre>
<span class="code-comment"># ./Dockerfile.development</span>
<b style="color: teal">FROM</b> elixir:latest
<b style="color: teal">RUN</b> echo Europe/Copenhagen > /etc/timezone
<b style="color: teal"> RUN</b> dpkg-reconfigure -f \
    noninteractive tzdata
<b style="color: teal">RUN</b> mix local.hex --force
<b style="color: teal">RUN</b> mix local.rebar --force
<b style="color: teal">RUN</b> mix archive.install --force\
    https://github.com/phoenixframework/\
    archives/raw/master/phoenix_new.ez
<b style="color: teal">RUN</b> curl -sL \
    https://deb.nodesource.com/setup_6.x\
    | bash -
<b style="color: teal">RUN</b> apt-get install -y -q \
    nodejs inotify-tools
<b style="color: teal">RUN</b> mkdir /app  
<b style="color: teal">WORKDIR</b> /app
<b style="color: teal">COPY</b> . /app  
<b style="color: teal">EXPOSE</b> "4000"
                    </pre>
                </pre>
              </div>
              <!-- .end .column -->
            </div>
            <!-- .end .grid -->
          </div>
          <!-- .end .wrap -->
        </section>

        
        <!-- slide 13 -->
        <section>
          <!--.wrap = container (width: 90%) -->
          <div class="wrap">
            <div class="grid vertical-align">
              <div class="column">
                <h3><strong>1: Develop</strong> - <small>hands-off!</small></h3>
                <p class="text-intro">Running a CI in GitLab</p>
                <p>Requires you to install GitLab on a server (or buy the service) - and install a 'runner' (eg. on your workstation)</p>
                <pre class="steps">
                  <dl class="text-interview">
                    <dt>1</dt><dd>sudo curl --output /usr/local/bin/gitlab-runner https://gitlab-ci-multi-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-ci-multi-runner-darwin-amd64</dd>
                    <dt>2</dt><dd>gitlab-runner register</dd>
                    <dt>3</dt><dd>gitlab-runner run</dd>
                    <dt>4</dt><dd>vi .gitlab-ci.yml</dd>
                    <dt></dt><dd>(do some development)</dd>
                    <dt>5</dt><dd>git add .</dd>
                    <dt>6</dt><dd>git commit -m 'smart ass comments'</dd>
                    <dt>7</dt><dd>git push</dd>
                  </dl>
                </pre>
                <p>
                  <small>http://gitserver.alco.dk/walther/dock_phoenix/settings/ci_cd</small>
                  <br>
                  <small>https://docs.gitlab.com/runner/install/windows.html</small>
                </p>
                
              </div>
              <!-- .end .column -->
              <div class="column">
                <pre>
<span class="code-comment"># ./.gitlab-ci.yml</span>
<b style="color: blue">image: elixir:1.4</b>
<b style="color: blue">services:</b>
  - postgres:9.6.2
<b style="color: blue">variables:</b>
  <b style="color: blue">POSTGRES_DB_NAME:</b> dock_phoenix_test
  <b style="color: blue">POSTGRES_USER:</b> postgres
  <b style="color: blue">POSTGRES_PASSWORD:</b> postgres
<b style="color: blue">stages:</b>
  - test
<b style="color: blue">before_script:</b>
  - apt-get update
  - apt-get install --no-install-recommends\
    -y tzdata locales debconf 
  - echo 'da_DK.UTF-8 UTF-8' >> \
    /etc/locale.gen && locale-gen
  - export LANG=da_DK.UTF-8
  - echo Europe/Copenhagen > /etc/timezone
  - dpkg-reconfigure -f \
    noninteractive tzdata
<b style="color: blue">unit-testing:</b>
  <b style="color: blue">stage:</b> test
  <b style="color: blue">script:</b>
    - mix local.hex --force
    - mix local.rebar --force
    - mix deps.get
    - MIX_ENV=test mix ecto.create
    - MIX_ENV=test mix ecto.migrate
    - MIX_ENV=test mix test
                    </pre>
                </pre>
              </div>
              <!-- .end .column -->
            </div>
            <!-- .end .grid -->
          </div>
          <!-- .end .wrap -->
        </section>

        
        <!-- slide 14 -->
        <section>
          <span data-step-count=3></span>
          <div class="wrap">
            <h2><strong>2: Build</strong>- prelude</h2>
            <p class="text-intro">Erlang is not backwards compatible! Upgrading Elixir installations requires serious downtime!</p>
            <div class="grid">
              <div class="column">
                <ul class="">
                  <!-- animate first step -->
                  <li class="animate-show" data-step=1>
                    <p>OS - is a challenge. Which OS is this?</p>
                  </li>
                  <!-- animate second step -->
                  <li class="animate-show" data-step=2>
                    <p>Migrations - are a challenge. </p>
                  </li>
                </ul>

              </div>
              <div class="column">
                <ul class="">
                  <!-- animate first step -->
                  <li class="animate-show" data-step=1>
                    <p>Docker to the rescue!!</p>
                    <p>Keep your Dockerfile 100% close to what you use in production — the same Linux distribution version, the same Erlang and Elixir versions</p>
                    <p><span style="color: red">Do not use hot code upgrades </span> - when using Docker containers, hot code upgrades adds nothing</p>
                    <p>Rsync the release catalog; (alledgedly) this will allow rsync to only send the actual changes (much faster) [red. untested!]</p>
                  </li>
                  <!-- animate second step -->
                  <li class="animate-show" data-step=2>
                    <p>Make deployments close-to-atomic by preparing everything on the server and then only switching the symlink to the new release (and forcing a restart); this is know as “current” symlink in the Rails world  [red. untested!]</p>
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </section>

        <!-- slide 15 -->
        <section>
          <div class="wrap">
            <h2><strong>2: Build</strong>- handjob</h2>
            <p class="text-intro">Building releases w/Docker is - easy</p>
            <div class="grid">
              <div class="column">
                <p>Pick an image / Build an image matching your server</p>
                <p>Consider running production in a Docker (no empirical data on watermark) [red. untested]</p>
              </div>
              <div class="column">
                <pre class="steps">
                  <dl class="text-interview">
                    <dt>1</dt><dd><span style="background-color: yellow">docker-compose run --rm dock_phoenix</span> mix release.init</dd>
                    <dt>2</dt><dd><span style="background-color: yellow">docker-compose run -e MIX_ENV=prod --rm dock_phoenix </span> mix release --env=prod</dd>
                  </dl>
                </pre>
                <p></p>
              </div>
            </div>
          </div>
        </section>

        <!-- slide 16 -->
        <section>
          <div class="wrap">
            <h2><strong>2: Build</strong>- cruise control</h2>
            <p class="text-intro">Using edeliver to automate jobs</p>
            <div class="grid">
              <div class="column">
                <p><strong>Local (semi-container)</strong><br>Build and deploy (from) local</p>
                
                <p>Add edeliver to 'the mix'</p>
                <p>Create .deliver/config</p>
                <p><code>echo ".deliver/releases/" >> .gitignore</code></p>
                <pre class="steps">
                  <dl class="text-interview">
                    <dt>1</dt><dd>git add -A && git commit -m "Setting up edeliver"</dd>
                    <dt>2</dt><dd>mix do deps.get, compile</dd>
                    <dt>3</dt><dd>env MIX_ENV=prod mix edeliver build release</dd>
                  </dl>
                </pre>
              </div>
              <div class="column">
                <p><strong>Local (full-container)</strong><br>Build and deploy (from) within containers:</p>
                <pre class="steps">
                  <dl class="text-interview">
                    <dt>1</dt><dd>git add -A && git commit -m "Setting up edeliver"</dd>
                    <dt>2</dt><dd>docker-compose run dock_phoenix mix do deps.get, compile</dd>
                    <dt>3</dt><dd>docker-compose run dock_phoenix env MIX_ENV=prod mix edeliver build release</dd>
                  </dl>
                </pre>
                <p>if strategy is full-containerization releasing the 'prod' environment is only necessary pertaining to other settings/configs in Phoenix!</p>
              </div>
            </div>
          </div>
        </section>

        
        <!-- slide 17 -->
        <section>
          <div class="wrap">
            <h2><strong>3: Upload</strong></h2>
            <p class="text-intro">Will depend on strategy</p>
            <div class="grid">
              <div class="column">
                <p><strong>Docker Hub</strong><br>Using the Docker Hub (or a private ditto) will require us to first upload the image; <a href="https://blog.codeship.com/using-docker-push-to-publish-images-to-dockerhub">this link</a> has the fine print on that.</p>
                <p><strong>Build in local container</strong><br>Doing a local build will require us to prep the server initially, build (in the local container) and then scp/rsync tar.gz (without ERTS - fastest) to server</p>
                <p>- or - a local build in container (with ERTS) and then scp/rsync tar.gz (somewhat slower)</p>
                <p><strong>Docker Containers built on deployment</strong><br>
                  Building images on the server via ssh && git pull & build/release</p>
              </div>
              <div class="column">
                Local build (with ERTS)
                <pre >
scp _build/prod/rel/APP_NAME/releases/CURRENT_VERSION/APP_NAME.tar.gz. to/destination/path

rsync _build/prod/rel/APP_NAME/releases/CURRENT_VERSION/APP_NAME.tar.gz. destination/to/sync/with
                </pre>
                <p></p>
                Local build (semi-container)
                <pre>
env MIX_ENV=prod mix edeliver deploy release production
                </pre>
                <p></p>
                Local build (full-container)
                <pre>
docker-compose run dock_phoenix env MIX_ENV=prod mix edeliver deploy release production
                  </dl>
                </pre>
              </div>
            </div>
          </div>
        </section>

        
        <!-- slide 18 -->
        <section class=" slide-top slide">
          <span class="background-left-bottom" style=" transform: rotate(-5deg); background-image:url('static/images/ruby5.png')"></span>

          <div class="wrap" style="color: black">
            <div>
              <h2><strong>4: Connect</strong>- always use "jelly"</h2>
              <p class="text-intro">SSH is the preferred way to connect from your workstation</p>
            </div>
            <div class="grid " style="color: black">
              <div class="column">
              </div>
              <div class="column">
                <pre class="steps">
                  <dl class="text-interview">
                    <dt>1</dt><dd>ssh-keygen</dd>
                    <dt>2</dt><dd>scp ~/.ssh/id_.sa.pub root@FQDN:/tmp/fil && cat /tmp/fil >> /home/USER/.ssh/authorized_keys</dd>
                  </dl>
                </pre>
                <p></p>
                <pre>
                  <dl class="text-interview">
                    <dt>1</dt><dd>ssh ruby5.alco.dk</dd>
                    <dt>2</dt><dd>cd www/jobbers/production/jobbers</dd>
                  </dl>
                </pre>
              </div>
            </div>
          </div>

        </section>

        
        <!-- slide 19 -->
        <section>
          <div class="wrap">
            <h2><strong>5: Download</strong></h2>
            <p class="text-intro">If the build strategy is: Dockerfile</p>
            <div class="grid">
              <div class="column">
                <p>If we've decided to release our app as source w/Dockerfile we will have to go through this recipe:</p>
              </div>
              <div class="column">
                <pre>
                  <dl class="text-interview">
                    <dt>1</dt><dd>git pull</dd>
                    <dt>2</dt><dd>env MIX_ENV=prod mix edeliver build release</dd>
                    <dt>3</dt><dd>env MIX_ENV=prod mix edeliver deploy release production</dd>
                    <dt>4</dt><dd>move tar to 'current' folder</dd>
                  </dl>
                </pre>
              </div>
            </div>
          </div>
        </section>

        
        <!-- slide 20 -->
        <section>
          <div class="wrap">
            <h2><strong>6: Restart</strong>- stop/go</h2>
            <p class="text-intro"></p>
            <div class="grid">
              <div class="column">
              </div>
              <div class="column">
                <pre>
                  <dl class="text-interview">
                    <dt>1</dt><dd>bin/jobbers stop</dd>
                    <dt>2</dt><dd>PORT=4000 bin/jobbers start</dd>
                  </dl>
                </pre>
              </div>
            </div>
          </div>
        </section>

        <!-- <section>
          <span data-step-count=3></span>
          <span class="background"></span>
          <header>
            <h1 class="aligncenter">Title</h1>
          </header>
          <div class="wrap">
            <ul class="flexblock">
              <!-- animate first step --
              <li class="animate-show" data-step=1>
                <p class="aligncenter">FOO</p>
              </li>
              <!-- animate second step --
              <li class="animate-show" data-step=2>
                <p class="aligncenter">BAR</p>
              </li>
              <!-- animate third step --
              <li class="animate-show" data-step=3>
                <p class="aligncenter">BAZ</p>
              </li>
            </ul>
          </div>
        </section> -->


        <section>
          <div class="wrap">
            <div class="grid vertical-align">
              <div class="column">
                <h4>
                  <svg class="fa-life-ring">
                    <use xlink:href="#fa-life-ring"></use>
                  </svg>
                  <strong>Guides</strong>
                </h4>
                <p>To get you started with Dockers here are a few links:</p>
                <ul class="description">
                  <li><a href="https://github.com/docker/labs/blob/master/beginner/chapters/alpine.md" title="Docker 1st Tutorial">Your first docker commands</a>,</li>
                  <li><a href="https://github.com/docker/labs/blob/master/beginner/chapters/votingapp.md" title="Docker Swarm">then take it to the next level with Swarms</a>,</li>
                  <li><a href="https://github.com/wsargent/docker-cheat-sheet" title="Docker Cheat Sheet">and finally a cheat-sheet</a>.</li>
                </ul>
              </div>
              <!-- <div class="column">
                <p class="tiny"><b>Ethos</b>(Greek for 'character') refers to how trustworthy or credible the speaker or writer is and how knowledgeable he or she is concerning a subject. If the audience is familiar with the speaker or writer, then her reputation will be important here. Is she an expert in the field? Does she have relevant experience? If the speaker or writer is unknown to the audience, then she will need to establish ethos solely through the text itself. Ethos is often conveyed through tone and style of the message and through the way the writer or speaker refers to differing views. Writers and speakers use ethos when they connect their argument to their audience's own set of views.</p>
                
                <p class="tiny"><b>Pathos</b> (Greek for 'suffering' or 'experience'), while often associated with emotions, is more broadly an appeal that draws upon the audience's emotions, sympathies, interests, and/or imagination. With an appeal to pathos, the audience is encouraged to identify with the speaker or writer – to feel or experience what the writer feels. As the meaning of pathos implies, the audience "suffers," in the realm of the imagination, what the rhetor suffers.</p>

                <p class="tiny"><b>Logos</b> (Greek for 'word') refers to the clarity of the message's claim, its logic, and the effectiveness of its supporting evidence. The audience should be able to follow a clear progression of concepts backed up with reasonable and appropriate details.                </p>
              </div> -->
              <div class="column">
                <h4>
                  <svg class="fa-cubes">
                    <use xlink:href="#fa-cubes"></use>
                  </svg>
                  <strong>Books to supplement</strong>
                </h4>
                <p>A few book references to sweaten the deal:</p>
                <ul class="description">
                  <li>fra 2015 (men gode pointer): <a href="https://www.safaribooksonline.com/library/view/docker-cookbook/9781491919705/">Docker Cookbook</a>.</li>
                  <li>James Turnbull: <a href="https://www.dockerbook.com/">The docker Book</a>.</li>
                </ul>
              </div>
            </div>
            <!--end .grid -->
          </div>
        </section>
        <section class="slide-bottom">
          <img src="/static/images/jonathan-simcoe-88013.jpg" alt="" style="width: 30%" />
          <div class="wrap">
            <div class="content-right text-serif">
              <h2>
                <strong>Thanks.</strong>
                <a target="_blank" title="Share on Twitter" href="https://twitter.com/intent/tweet?text=Enjoyed%20#ElixirPhoenixwithDockerAppProvisioning%20presentation%20by@wdiechmann">
                  <svg class="fa-twitter">
                    <use xlink:href="#fa-twitter"></use>
                  </svg>
                </a>
              </h2>
              <p> <quote>Ding, ding - I like the ring of the bell-boy bell, it reminds me who the customer is; and that there is a fresh one waiting in anticipation!</quote> </p> 
              <p>Best,<br> <a href="https://twitter.com/wdiechmann">@wdiechmann</a>.</p>
            </div>
            <!-- .end .content-right -->
          </div>
          <!-- .end .wrap -->
        </section>

        
        <section class="fullscreen">
          <!-- Fullscreen Video -->
          <div class="embed">
            <iframe width="1920" height="1080" src="https://www.youtube.com/embed/tI2ASp0f7GU?list=RDKNAGkcC-NAM" frameborder="0" allowfullscreen></iframe>
          </div>
          <!-- .end .embed -->
          <h1><strong style="font-size: 72px;color: white">School is Over!</strong></h1>
          <p class="text-intro"><br>
            Tina Guo - Wonder Woman Theme
          </p>
        </section>


      </article>
      <!-- end article -->
    </main>
    <!-- end main -->

   <!-- A global footer

     <footer role="contentinfo">
      <div class="wrap">
        <p>An <a href="https://github.com/webslides/webslides">open source solution</a>, by <a href="https://twitter.com/webslides">@webslides</a>.</p>
      </div>
    </footer>  -->

    <!-- Required -->
    <script src="static/js/webslides.js"></script>
    <script src="static/js/webslides-animation.js"></script>
    <script>
      window.ws = new WebSlides();
      new WebSlidesAnimation(window.ws);
      </script>
    </script>

    <!-- OPTIONAL - svg-icons.js (fontastic.me - Font Awesome as svg icons) -->
    <script defer src="static/js/svg-icons.js"></script>

  </body>
</html>
